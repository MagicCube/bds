/* Wed Apr 02 11:07:17 CST 2014 */
/* Generated by MagicCube MXBuild with MXFramework */
$ns("bds.ui");$import("lib.leaflet.leaflet");$import("lib.transit.transit");$import("bds.ui.data.RouteManager");$import("bds.ui.data.VehicleManager");$import("bds.ui.view.ChainView");$import("bds.ui.view.ClockView");$import("bds.ui.view.CirculationVehicleListView");$import("bds.ui.view.FrequencySwitchView");$import("bds.ui.view.LoadHistoryChartView");$import("bds.ui.view.MapView");$import("bds.ui.view.PassengersChartView");$import("bds.ui.view.ReservedVehicleListView");$include("lib.leaflet.leaflet.css");
$include("bds.res.App.css");
bds.ui.App=function(){function k(){a.chainView=new bds.ui.view.ChainView({elementStyle:{zIndex:9999999,display:"none"},frame:{left:0,right:0,top:0,bottom:0},onclose:function(){a.hideChain()}})}function b(){var b=a.$container.find("#lists").width();a.frequencySwitchView=new bds.ui.view.FrequencySwitchView({$element:a.$container.find("#switch"),onchanged:function(){x=null;h.addClass("empty");h.val(z);"reserved"==a.frequencySwitchView.selection?(a.reservedListView.query(null),a.circulationListView.$container.transition({x:-b},
300,"in"),a.reservedListView.$container.transition({x:-b},300,"in")):(a.circulationListView.query(null),a.circulationListView.$container.transition({x:0},300,"in"),a.reservedListView.$container.transition({x:0},300,"in"))}});a.frequencySwitchView.parentView=a}function n(){var b=a.$container.find("#lists").width(),c=a.$container.find("#lists").height();a.circulationListView=new bds.ui.view.CirculationVehicleListView({frame:{left:0,width:b,height:c},onvehicleclick:function(b){a.mapView.selectVehicle(b.vehicle.id)}});
a.addSubview(a.circulationListView,a.$container.find("#lists"))}function f(){var b=a.$container.find("#lists").width(),c=a.$container.find("#lists").height();a.reservedListView=new bds.ui.view.ReservedVehicleListView({frame:{left:b,width:b,height:c}});a.addSubview(a.reservedListView,a.$container.find("#lists"))}function m(b){switch(a.mapView.selectionType){case "vehicle":a.loadHistoryChartView.$container.show();a.passengerChartView.$container.hide();a.loadHistoryChartView.setVehicle(a.mapView.selection);
break;case "stop":a.loadHistoryChartView.$container.hide();a.passengerChartView.$container.show();a.passengerChartView.loadPassengers(a.mapView.selection.desc);break;default:a.loadHistoryChartView.$container.hide(),a.passengerChartView.$container.show(),a.passengerChartView.loadPassengers(null)}}function d(a){null!=q&&(clearInterval(q),q=null);h.hasClass("empty")&&(h.removeClass("empty"),h.val(""));q=setInterval(e,800)}function u(a){null!=q&&(clearInterval(q),q=null);""==h.val().trim()&&(h.addClass("empty"),
h.val(z))}function e(){if(null==x||x!=h.val())x=h.val().trim(),""==x&&(x=null),"circulation"==a.frequencySwitchView.selection?a.circulationListView.query(x):a.reservedListView.query(x)}var a=$extend(mx.app.Application);a.appId="bds.ui.App";a.appDisplayName="Operations Control Center";var p={};a.mapView=null;a.chainView=null;a.passengerChartView=null;a.loadHistoryChartView=null;a.frequencySwitchView=null;a.circulationListView=null;a.reservedListView=null;var c=a.clockView=null,v=null;p.init=a.init;
a.init=function(e){p.init(e);a.$container.children("#top");c=a.$container.children("#body");e=0.3*window.innerHeight;c.css("bottom",e);v=a.$container.children("#bottom");v.css("height",e);a.mapView=new bds.ui.view.MapView({$element:a.$container.find("#map"),frame:{left:0,width:0.6*window.innerWidth,top:0,bottom:0},onselectionchanged:m});a.mapView.parentView=a;k();a.passengerChartView=new bds.ui.view.PassengersChartView({frame:{width:a.$container.find("#bottom").width(),height:a.$container.find("#bottom").height()}});
a.addSubview(a.passengerChartView,a.$container.find("#chart"));a.loadHistoryChartView=new bds.ui.view.LoadHistoryChartView({elementStyle:{display:"none"},frame:{width:a.$container.find("#bottom").width(),height:a.$container.find("#bottom").height()}});a.addSubview(a.loadHistoryChartView,a.$container.find("#chart"));b();n();f();h.val(z);h.addClass("empty");h.on("focus",d);h.on("blur",u);a.$container.find("#frequencyPanel").append(h);bds.ui.data.RouteManager.on("updated",function(){console.log("bds.ui.dataRouteManager.onupdate");
a.mapView.drawRoutes();a.passengerChartView.loadPassengers();bds.ui.data.VehicleManager.update()});bds.ui.data.VehicleManager.on("updated",function(){a.circulationListView.setVehicles(bds.ui.data.VehicleManager.vehicles);a.mapView.drawVehicles()});$(window).on("keydown",function(b){27==b.keyCode&&a.hideChain()})};a.getTime=function(){var a=new Date;$offline||(a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getUTCHours(),a.getUTCMinutes()),a=a.addHours(-7));return a};p.run=a.run;a.run=function(b){a.clockView=
new bds.ui.view.ClockView({frame:{right:5,top:21}});a.addSubview(a.clockView);a.mapView.loadMap();bds.ui.data.RouteManager.update()};a.showChain=function(){a.chainView.$element.css({display:"block",scale:0.7,opacity:0.1});a.addSubview(a.chainView);var b=a.mapView.selection,b={vehicle:b,factor:b.load/100,delaySecond:b.delay,routeNumber:b.routeLine.number,stops:b.routeLine.stops,currentStopSeq:b.lastStopSeq};console.log(b);a.chainView.setSelectedLine(b);a.chainView.$element.transit({scale:1,opacity:1})};
a.hideChain=function(){a.chainView.$element.transit({scale:0.7,opacity:0},function(){a.removeSubview(a.chainView)})};var h=$("\x3cinput type\x3d'text' id\x3d'search' autocomplete\x3d'off'\x3e"),z="Line, stop, plate or status",q=null,x=null;return a.endOfClass(arguments)};bds.ui.App.className="bds.ui.App";bds.ui.App.getTime=function(){var k=new Date;$offline||(k=new Date(k.getFullYear(),k.getMonth(),k.getDate(),k.getUTCHours(),k.getUTCMinutes()),k=k.addHours(-7));return k};$ns("bds.ui.data");
bds.ui.data.RouteManagerClass=function(){function k(a){a=$(a).find("Placemark");for(var p=0,c=0;c<a.length;c++){var m=a.eq(c),h=parseInt(m.find("Data[name\x3droute_number]").text()),k=parseInt(m.find("Data[name\x3ddirection]").text()),q=m.find("Data[name\x3ddirection_description]").text().trim();if(null==d["r"+h]){d["r"+h]=d[p];var x=L.icon({iconUrl:mx.getResourcePath("bds.res.images.vehicle-"+$format(p,"00"),"png"),iconSize:[28,36],iconAnchor:[14,36]}),n=L.icon({iconUrl:mx.getResourcePath("bds.res.images.warning-"+$format(p,
"00"),"png"),iconSize:[66,66],iconAnchor:[33,33]});u["r"+h]=x;e["r"+h]=n;p++}f.routeNumbers.contains(h)||f.routeNumbers.add(h);h={id:"r"+h+"-"+k,number:h,direction:k,directionDesc:q,color:d["r"+h],icon:u["r"+h],warningIcon:e["r"+h]};f.routeLines[h.id]=h;f.routeLines.add(h);m=b(m.find("LineString"));h.path=m}$.ajax({url:mx.getResourcePath("bds.res.data.routes","json")}).done(function(a){f.routes=a.resultSet.route;for(a=0;a<f.routes.length;a++){var b=f.routes[a],c=b.route;f.routes["r"+c]=b;b.color=
d["r"+c];b.icon=u["r"+c];b.warningIcon=e["r"+c];for(var p=0;p<b.dir.length;p++){var q=b.dir[p],h=f.getRouteLine(c,q.dir);h.stops=q.stop;h.stops.forEach(function(a){a.id=a.locid;a.routeLine=h;f.stops.add(a);f.stops["s"+a.id]=a})}}for(a=0;a<f.routeLines.length;a++)h=f.routeLines[a],h.route=f.getRoute(h.number);f.trigger("updated")})}function b(a){for(var b=[],c=0;c<a.length;c++){var e=a.eq(c);b.add(n(e))}return b}function n(a){return a.find("coordinates").text().trim().split(" ").map(function(a){a=
a.trim();return""!=a?(a=eval("["+a+"]"),2==a.length?a.reverse():null):null}).filter(function(a){return null!=a})}var f=$extend(MXComponent),m={};f.routes=[];f.routeLines=[];f.routeNumbers=[];f.stops=[];f.onupdated=null;var d=["#FF0000","#F7931E","#8CC63F","#93278F","#29ABE2"],u={},e={};m.init=f.init;f.init=function(a){m.init(a)};f.getRoute=function(a){return f.routes["r"+a]};f.getRouteLine=function(a,b){return f.routeLines["r"+a+"-"+b]};f.getStop=function(a){return f.stops["s"+a]};f.update=function(){$.ajax({url:mx.getResourcePath("bds.res.data.routes",
"kml")}).done(function(a){k(a)})};return f.endOfClass(arguments)};bds.ui.data.RouteManagerClass.className="bds.ui.data.RouteManagerClass";bds.ui.data.RouteManager=new bds.ui.data.RouteManagerClass;$ns("bds.ui.data");
bds.ui.data.VehicleManagerClass=function(){function k(b){if(null==f["v"+b]){var e={id:b,plateNumber:"E"+(1E5+Math.round(2E5*Math.random())),crew:m[Math.round(Math.random()*(m.length-1))],load:25+Math.round(40*Math.random())};f["v"+e.id]=e;f.add(e)}return f["v"+b]}var b=$extend(MXComponent),n={};b.vehicles=[];b.autoUpdate=!0;b.autoUpdateInterval=3E4;b.onupdated=null;var f=[],m=[{id:"c120054",age:34,name:"Christa Gentry",gender:"female",phone:"+1 (927) 433-3887"},{id:"c159139",age:34,name:"Roberts Mccullough",
gender:"male",phone:"+1 (854) 577-3795"},{id:"c138709",age:30,name:"Doris Chandler",gender:"female",phone:"+1 (926) 419-3024"},{id:"c175019",age:26,name:"Hebert Compton",gender:"male",phone:"+1 (965) 581-3361"},{id:"c149790",age:26,name:"Benson Austin",gender:"male",phone:"+1 (998) 563-3540"},{id:"c123607",age:39,name:"Fisher Ellison",gender:"male",phone:"+1 (991) 585-3449"},{id:"c123767",age:25,name:"Hicks Dean",gender:"male",phone:"+1 (959) 573-2517"},{id:"c174745",age:40,name:"Frieda Rivera",gender:"female",
phone:"+1 (807) 463-2084"},{id:"c105435",age:25,name:"Sonya Cobb",gender:"female",phone:"+1 (878) 474-3578"},{id:"c108472",age:26,name:"Gaines Luna",gender:"male",phone:"+1 (967) 413-3940"},{id:"c155369",age:34,name:"Deirdre Sutton",gender:"female",phone:"+1 (995) 593-2186"},{id:"c165222",age:37,name:"Avila Delacruz",gender:"male",phone:"+1 (980) 581-3698"},{id:"c187623",age:29,name:"Anderson Blevins",gender:"male",phone:"+1 (906) 589-2132"},{id:"c198359",age:22,name:"Mamie Simmons",gender:"female",
phone:"+1 (918) 483-2083"},{id:"c146785",age:36,name:"Kline Randall",gender:"male",phone:"+1 (848) 574-3392"},{id:"c174319",age:27,name:"Lynch Graham",gender:"male",phone:"+1 (976) 463-3237"},{id:"c109807",age:25,name:"Natasha Gallegos",gender:"female",phone:"+1 (981) 583-2202"},{id:"c129899",age:27,name:"Tran Schneider",gender:"male",phone:"+1 (924) 587-2912"},{id:"c168011",age:33,name:"Swanson Bailey",gender:"male",phone:"+1 (849) 425-3225"},{id:"c118861",age:35,name:"Fulton Holman",gender:"male",
phone:"+1 (853) 525-2235"},{id:"c118420",age:40,name:"Boyle Hansen",gender:"male",phone:"+1 (932) 401-2792"},{id:"c120213",age:35,name:"Mccormick Pittman",gender:"male",phone:"+1 (838) 467-2567"},{id:"c103510",age:29,name:"King Dale",gender:"male",phone:"+1 (965) 559-2973"},{id:"c177943",age:30,name:"Kerr Lewis",gender:"male",phone:"+1 (837) 505-2800"},{id:"c111965",age:29,name:"Shelton Ward",gender:"male",phone:"+1 (836) 491-2528"},{id:"c179775",age:27,name:"Stacey Chapman",gender:"female",phone:"+1 (989) 492-3472"},
{id:"c147558",age:27,name:"Helen Combs",gender:"female",phone:"+1 (973) 557-2640"},{id:"c117293",age:22,name:"Wilma Watts",gender:"female",phone:"+1 (806) 418-3996"},{id:"c171177",age:27,name:"Celia Donovan",gender:"female",phone:"+1 (990) 597-3531"},{id:"c191432",age:28,name:"Monique Winters",gender:"female",phone:"+1 (806) 519-3292"},{id:"c154950",age:39,name:"Shepherd Blake",gender:"male",phone:"+1 (810) 551-3976"},{id:"c115139",age:31,name:"Kayla Larsen",gender:"female",phone:"+1 (882) 454-2943"},
{id:"c105920",age:40,name:"Tina Petty",gender:"female",phone:"+1 (846) 494-3610"},{id:"c162749",age:22,name:"Chapman Greer",gender:"male",phone:"+1 (840) 476-3985"},{id:"c129965",age:37,name:"Clements Barrett",gender:"male",phone:"+1 (980) 521-3772"},{id:"c140294",age:38,name:"Vickie Wiley",gender:"female",phone:"+1 (985) 588-2183"},{id:"c143492",age:23,name:"Brandie Horn",gender:"female",phone:"+1 (837) 535-3080"},{id:"c199423",age:31,name:"Reeves Wood",gender:"male",phone:"+1 (845) 531-2928"},{id:"c160965",
age:40,name:"Meagan Head",gender:"female",phone:"+1 (813) 485-2440"},{id:"c177802",age:30,name:"Wilda Bradley",gender:"female",phone:"+1 (826) 487-3709"},{id:"c146855",age:37,name:"Lucia Calhoun",gender:"female",phone:"+1 (966) 565-3199"},{id:"c154525",age:29,name:"Jami Ramsey",gender:"female",phone:"+1 (989) 576-3884"},{id:"c187787",age:27,name:"Stephenson Mayo",gender:"male",phone:"+1 (805) 550-2362"},{id:"c103052",age:35,name:"Wall Kerr",gender:"male",phone:"+1 (931) 481-3494"},{id:"c165543",age:37,
name:"Kristin Ballard",gender:"female",phone:"+1 (878) 425-3450"},{id:"c102310",age:28,name:"Minerva Collins",gender:"female",phone:"+1 (952) 432-2739"},{id:"c171652",age:37,name:"Tasha Tanner",gender:"female",phone:"+1 (834) 446-3580"},{id:"c103485",age:23,name:"Fay Mcintyre",gender:"female",phone:"+1 (994) 566-2482"},{id:"c136952",age:28,name:"Melisa Gutierrez",gender:"female",phone:"+1 (935) 471-2459"},{id:"c172473",age:37,name:"Sheri Owen",gender:"female",phone:"+1 (974) 507-2129"},{id:"c198739",
age:30,name:"Gail Turner",gender:"female",phone:"+1 (993) 596-3049"},{id:"c179411",age:35,name:"Christie Drake",gender:"female",phone:"+1 (941) 495-2756"},{id:"c187813",age:38,name:"Cara Pruitt",gender:"female",phone:"+1 (841) 543-2740"},{id:"c174448",age:34,name:"Weaver Williams",gender:"male",phone:"+1 (852) 425-2023"},{id:"c122062",age:31,name:"Patricia Estrada",gender:"female",phone:"+1 (971) 519-3665"},{id:"c177612",age:22,name:"Watkins Hooper",gender:"male",phone:"+1 (984) 456-2054"},{id:"c131823",
age:38,name:"Darla Castillo",gender:"female",phone:"+1 (949) 505-3311"},{id:"c128455",age:35,name:"Paige Snider",gender:"female",phone:"+1 (882) 581-3151"},{id:"c109315",age:23,name:"Nannie Henderson",gender:"female",phone:"+1 (844) 405-2448"},{id:"c119005",age:37,name:"Luann Roth",gender:"female",phone:"+1 (940) 500-3172"},{id:"c137015",age:38,name:"Brown Thornton",gender:"male",phone:"+1 (920) 484-2842"},{id:"c147269",age:31,name:"Rogers Mclean",gender:"male",phone:"+1 (801) 481-2910"},{id:"c157390",
age:40,name:"Cheri Guerrero",gender:"female",phone:"+1 (851) 472-2131"},{id:"c189818",age:24,name:"Evangelina Cleveland",gender:"female",phone:"+1 (859) 494-3373"},{id:"c195473",age:39,name:"Wells Wilkinson",gender:"male",phone:"+1 (873) 518-2982"},{id:"c153349",age:29,name:"Cline Vincent",gender:"male",phone:"+1 (959) 476-2120"},{id:"c116278",age:31,name:"Stokes Rosa",gender:"male",phone:"+1 (873) 430-3905"},{id:"c120767",age:23,name:"Alejandra Mcclain",gender:"female",phone:"+1 (813) 591-3103"},
{id:"c189215",age:24,name:"Wynn Hawkins",gender:"male",phone:"+1 (987) 529-3815"},{id:"c181523",age:35,name:"Bond Walters",gender:"male",phone:"+1 (832) 427-3482"},{id:"c195473",age:34,name:"Ann Alvarado",gender:"female",phone:"+1 (987) 554-3259"},{id:"c141922",age:27,name:"Janell Gilliam",gender:"female",phone:"+1 (950) 535-2972"},{id:"c105429",age:25,name:"Guzman Stevenson",gender:"male",phone:"+1 (962) 600-3406"},{id:"c125036",age:38,name:"Hoffman Weeks",gender:"male",phone:"+1 (967) 471-3272"},
{id:"c147742",age:22,name:"Whitney Soto",gender:"female",phone:"+1 (871) 554-2619"},{id:"c189669",age:25,name:"Kramer Juarez",gender:"male",phone:"+1 (981) 579-2510"},{id:"c100147",age:37,name:"Sharpe Osborn",gender:"male",phone:"+1 (852) 573-2450"},{id:"c177734",age:25,name:"Kirk Daniel",gender:"male",phone:"+1 (979) 509-2683"},{id:"c155620",age:26,name:"John Fuller",gender:"female",phone:"+1 (819) 594-2126"},{id:"c106209",age:32,name:"Vega Torres",gender:"male",phone:"+1 (941) 449-2481"},{id:"c121748",
age:24,name:"Silvia Morrison",gender:"female",phone:"+1 (961) 434-3313"},{id:"c149256",age:33,name:"Jillian Lawrence",gender:"female",phone:"+1 (885) 411-2479"},{id:"c104070",age:35,name:"Sweeney Ware",gender:"male",phone:"+1 (932) 593-2820"},{id:"c133288",age:34,name:"Lupe Yates",gender:"female",phone:"+1 (818) 425-3590"},{id:"c118121",age:32,name:"Socorro Vaughan",gender:"female",phone:"+1 (948) 586-3239"},{id:"c106487",age:30,name:"Justice Bartlett",gender:"male",phone:"+1 (921) 452-2177"},{id:"c143291",
age:32,name:"Latasha Erickson",gender:"female",phone:"+1 (841) 440-3627"},{id:"c131882",age:40,name:"Nikki Acosta",gender:"female",phone:"+1 (825) 444-2041"},{id:"c132890",age:23,name:"Mallory Mccarthy",gender:"female",phone:"+1 (946) 589-2999"},{id:"c179226",age:40,name:"Enid Dawson",gender:"female",phone:"+1 (887) 468-2669"},{id:"c168358",age:38,name:"Burns Henson",gender:"male",phone:"+1 (838) 464-2676"},{id:"c192187",age:26,name:"Alvarez Sharp",gender:"male",phone:"+1 (861) 419-2602"},{id:"c161559",
age:34,name:"Sloan Gilmore",gender:"male",phone:"+1 (941) 493-3190"},{id:"c128915",age:38,name:"Moss Bond",gender:"male",phone:"+1 (914) 408-3101"},{id:"c151517",age:37,name:"Hudson Wilder",gender:"male",phone:"+1 (857) 581-2095"},{id:"c101893",age:36,name:"Davis Freeman",gender:"male",phone:"+1 (929) 412-3501"},{id:"c196910",age:27,name:"Gould Scott",gender:"male",phone:"+1 (821) 530-3369"},{id:"c138294",age:32,name:"Martin Dillon",gender:"male",phone:"+1 (928) 480-2341"},{id:"c196815",age:38,name:"Jacobs Rollins",
gender:"male",phone:"+1 (818) 474-2568"},{id:"c131251",age:29,name:"England Avila",gender:"male",phone:"+1 (951) 409-2147"}];n.init=b.init;b.init=function(b){n.init(b)};b.getVehicle=function(d){return b.vehicles["v"+d]};b.getReservedVehicles=function(){for(var b=[],e=1E6;1000034>e;e++){var a=k(e);a.vehicleID=a.id;a.status=0.8<Math.random()?"In Maintenance":"Available";a.place="Available"==a.status?"Station #"+(Math.round(6*Math.random())+1):"Garage";b.add(a)}return b};var d=null;b.update=function(){null!=
d&&(clearTimeout(d),d=null);var f="http://developer.trimet.org/beta/v2/vehicles?appID\x3d6DAD686944728A3074AC70AAE\x26routes\x3d31,14,72,77,70";$offline&&(f=mx.getResourcePath("bds.res.data.tremet.2014_03_25__"+$format(new Date,"HH_mm"),"json"));$.ajax({url:f}).done(function(e){b.vehicles=e.resultSet.vehicle;for(e=0;e<b.vehicles.length;e++){var a=b.vehicles[e];a.route=bds.ui.data.RouteManager.getRoute(a.routeNumber);a.routeLine=bds.ui.data.RouteManager.getRouteLine(a.routeNumber,a.direction);var d=
k(a.vehicleID);$.extend(a,d);b.vehicles["v"+a.vehicleID]=a;null==a.lastStopSeq&&(a.lastStopSeq=a.routeLine.stops.length-3);null==a.nextStopSeq&&(a.nextStopSeq=a.routeLine.stops.length-2);if(60<a.delay&&null==a.messages){var c=[],f=["Traffic","Emergency","Mechanical Problem","Others"],h=Math.floor(Math.random()*f.length);c.add({speaker:"crew",text:"Delay reason: "+f[h],time:bds.ui.app.getTime().addMinutes(-5)});d.messages=c;a.messages=c}}b.trigger("updated")});b.autoUpdate&&(d=setTimeout(b.update,
b.autoUpdateInterval))};return b.endOfClass(arguments)};bds.ui.data.VehicleManagerClass.className="bds.ui.data.VehicleManagerClass";bds.ui.data.VehicleManager=new bds.ui.data.VehicleManagerClass;$ns("bds.ui.view");$import("lib.d3js.d3");$import("lib.transit.transit");$import("bds.ui.view.ChatView");$import("bds.ui.view.PrecisionMarketingView");$include("bds.res.ChainView.css");
bds.ui.view.ChainView=function(){function k(){var a=$("\x3cdiv id\x3dODBtn class\x3dbutton\x3eO D\x3c/div\x3e");e.$container.append(a);a.on("click",u);a=$("\x3cdiv id\x3dcloseBtn class\x3dbutton\x3e\x3c/div\x3e");a.on("click",function(){e.trigger("close")});e.$container.append(a)}function b(a,b,c,l){var g=["red","green","#00ce7d","yellow","#CC0048"],d=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("basis");p.append("path").attr("d",d(b)).attr("stroke",g[l%5]).attr("stroke-width",
2).attr("fill","none");b=b[1].x-35;a=$("\x3cdiv id\x3d'"+l%5+"' class\x3dline \x3e"+a+"\x3c/div\x3e");a.css({top:c,left:b,background:g[l%5]});y.add(a);e.$container.append(a)}function n(){if(!P)if(!0==z)z=!1,P=!0,$(".arc").transit({opacity:0},300),$(".axiscircle").transit({opacity:0},300,function(){$.each(q,function(a,b){b.remove()});$.each(x,function(a,b){b.remove()});P=!1});else{for(var a=[],b=[],c=[],l=null,g=0;g<t.OD.length;g++)c.push(t.OD[g].number);l=eval(c.join("+"));a.push(l);b.push(l);for(g=
0;g<t.OD.length;g++)b.push(t.OD[g].number);for(g=0;g<t.OD.length;g++)a.push(t.OD[g].number);l=a.sort();l=d3.scale.linear().domain([d3.min(l),d3.max(l)]).range([10,30]);a=Q/2;g=p.append("svg:defs").append("svg:linearGradient").attr("id","gradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%").attr("spreadMethod","pad");g.append("svg:stop").attr("offset","0%").attr("stop-color","#00ffff").attr("stop-opacity",0.9);g.append("svg:stop").attr("offset","100%").attr("stop-color","#ffff00").attr("stop-opacity",
0.9);for(g=0;g<t.OD.length;g++)for(g=0;g<t.OD.length;g++){var c=M(t.OD[g].from)+a,e=M(t.OD[g].to)+a,f=l(b[g+1]),c=m([{x:c+f,y:I},{x:e-f,y:I},{x:e+f,y:I},{x:c-f,y:I}],320-160*g,f),c=p.append("path").attr("class","arc").attr("d",d(c)).style("fill","url(#gradient)").style("opacity",0);q.push(c)}c=t.stationName.indexOf(t.car);for(g=c+1;g<t.stationName.length;g++)e=p.append("circle").attr("class","axiscircle").attr("cx",M(t.stationName[g])+a).attr("cy",I).attr("r",l(b[g-1-c])).style("stroke","white").style("opacity",
0),g==c+1?e.style("fill","#00ffff"):e.style("fill","#ffff00"),x.push(e);P=!0;$(".arc").transit({opacity:1},300);$(".axiscircle").transit({opacity:1},300,function(){P=!1});z=!0}}function f(a){if("passengerNumber"==a.target.className){var b=$(".passenger#"+a.target.id);N=parseInt(b.css("left"));l=parseInt(b.css("top"))}else N=parseInt($(a.target).css("left").split("px")[0]),l=parseInt($(a.target).css("top").split("px")[0]);K=$(a.target).attr("id");null==B?(console.log("come here"),B=$("\x3cdiv id \x3d selectBackground\x3e"),
B.css({position:"absolute",top:0,left:0,width:c,height:v,background:"black",opacity:0.7,"z-index":999}),s=$("\x3cdiv id \x3d selectPanel\x3e"),s.css({position:"absolute",left:N-106.27,top:l-92.65,width:303,height:322,"z-index":9999}),e.$container.append(s),e.$container.append(B),H=d3.select("#selectPanel").append("svg").attr("id","selectSvg").attr("width","100%").attr("height","100%"),H.append("circle").attr("class","circle").attr("cx",151.27).attr("cy",152.65).attr("r",65).style("fill","#2F4F4F").style("z-index",
9999).style("stroke","white").style("stroke-width","6px").style("stroke-opacity","0.7"),H.append("circle").attr("class","circle").attr("cx",151.77).attr("cy",152.65).attr("r",144.65).style("fill","none").style("stroke","#b6c1c6").style("stroke-width","6px").style("stroke-opacity","1"),E.css({position:"absolute",top:112.65,left:117.27,width:74,height:74,"z-index":99999}),C.css({position:"absolute",top:-11,left:126.77,width:50,height:30,background:"url("+mx.getResourcePath("bds.res.images.triangle",
"png")+")","z-index":99999}),G.css({position:"absolute",top:10.5,left:29.77,width:243,height:100,cursor:"pointer"}),J.css({position:"absolute",top:83.94,left:10,width:139,height:210}),r.css({position:"absolute",top:83.94,left:154.98,width:139,height:210}),e.precisionMarketingView=new bds.ui.view.PrecisionMarketingView({frame:{left:-84,top:-154,width:500,height:133}}),e.chatView=new bds.ui.view.ChatView({frame:{left:-60,top:-300,width:460,height:270}}),e.addSubview(e.chatView,s),e.chatView.$element.hide(),
e.precisionMarketingView.$element.hide(),s.append(e.precisionMarketingView.$element),s.append(G),s.append(J),s.append(r),s.append(E),s.append(C),g=!0,C.hide(),G.on("click",function(){"carDiv"!=K?(e.precisionMarketingView.$element.show(),$("#PrecisionMarketing").css({scale:0.1},0),$("#PrecisionMarketing").transit({scale:1},325)):(e.chatView.$element.show(),$(".ChatView").css({scale:0.1},0),$(".ChatView").transit({scale:1},325,function(){e.chatView.setVehicle(e.vehicle)}));C.show()}),B.on("click",function(){B.hide();
s.hide();null!=e.precisionMarketingView&&e.precisionMarketingView.$element.hide();null!=e.chatView&&e.chatView.$element.hide();C.hide();g=!1})):!1==g&&(s.show(),B.show(),s.css({top:l-92.65,left:N-106.27}),g=!0);e.chatView.setVehicle(e.vehicle);"carDiv"==K?(e.$container.find("#count").text(e.vehicle.messages.length),E.css({background:"url("+mx.getResourcePath("bds.res.images.bus_center","png")+")"}),G.css({background:"url("+mx.getResourcePath("bds.res.images.bus_msg","png")+")"}),J.css({background:"url("+
mx.getResourcePath("bds.res.images.bus_maintenance","png")+")"}),r.css({background:"url("+mx.getResourcePath("bds.res.images.bus_crew","png")+")"})):(e.$container.find("#count").text(""),E.css({background:"url("+mx.getResourcePath("bds.res.images.passenger","png")+")"}),G.css({background:"url("+mx.getResourcePath("bds.res.images.coupon","png")+")"}),J.css({background:"url("+mx.getResourcePath("bds.res.images.ticket","png")+")"}),r.css({background:"url("+mx.getResourcePath("bds.res.images.msg","png")+
")"}));s.transit({scale:0.1,rotate:"180deg"},0);s.transit({scale:1,rotate:"0deg"},500)}function m(a,b,g){for(var c=[],l=0;l<a.length-1;l++)if(c.push(a[l]),1!=l){var e=null,d=null;0==l?(e={x:a[l].x,y:b},d={x:a[l+1].x,y:b}):0==l%2&&(e={x:a[l].x,y:b-2*g},d={x:a[l+1].x,y:b-2*g});c.push(e);c.push(d)}c.push(a[a.length-1]);return c}function d(a){for(var b="M",g=0;g<a.length;g++)if(b+=a[g].x,b+=",",b+=a[g].y,b+=" ",3==g)b+="L";else if(g==a.length-1)b+="Z";else if(0==g||4==g)b+="C";return b}function u(a){a=
e.$container.find("#"+a.currentTarget.id);a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected");n()}var e=$extend(mx.view.View);e.elementClass="ChainView";var a={};e.$element=$("\x3cdiv\x3e");e.$container=$("\x3cdiv id \x3d container\x3e");e.precisionMarketingView=null;e.chatView=null;e.vehicle=null;var p=e.onclose=null,c=null,v=null,h=null,z=!1,q=[],x=[],D=0.3,w=null,A=null,E=$("\x3cdiv id \x3d humanItem \x3e"),G=$("\x3cdiv id \x3d upItem \x3e\x3cdiv id\x3dcount\x3e\x3c/div\x3e\x3c/div\x3e"),
J=$("\x3cdiv id \x3d leftItem \x3e"),r=$("\x3cdiv id \x3d rightItem \x3e"),C=$("\x3cdiv id \x3d arrow\x3e"),y=[],t=null,F=null,O=null,B=null,s=null,H=null,N=500,l=200,g=!1,K=null,P=null;a.init=e.init;e.init=function(b){a.init(b);null==b.width&&(b={width:innerWidth,height:innerHeight,margin:{top:0,right:0,bottom:0,left:0}});c=b.width;v=b.height;e.$element.append(e.$container)};e.setSelectedLine=function(a){e.vehicle=a.vehicle;e.$container[0].innerHTML="";s=B=null;z=!1;if(null!=a){var g=a.stops,l=[],
d=a.currentStopSeq-1,q=d+5,q=q<g.length?q:g.length;for(d;d<q;d++)l.push(g[d].desc);g=a.factor;d=Math.round(a.delaySecond/60);q=l[0];a="Line"+a.routeNumber;for(var m=[null,null,null,null,null],K=[],n=1;4>n;n++){var x=Math.round(2*Math.random());if(0<x){m[n]=[];for(var u=0;u<x;u++){var r=parseInt(10*Math.random()+1);console.log(K.indexOf(r));for(console.log(K);-1<K.indexOf(r);)r=parseInt(10*Math.random()+1);K.push(r);m[n][u]="Line "+r}}}t={factor:g,delay:d,car:q,line:a,stationName:l,transferlines:m,
strandedPassengers:[null,Math.floor(20*Math.random())+1,Math.floor(30*Math.random())+1,Math.floor(10*Math.random())+1,null,null],OD:[{from:l[1],to:l[2],number:15*Math.random()+1},{from:l[1],to:l[3],number:5*Math.random()+1},{from:l[1],to:l[4],number:40*Math.random()+1}]};O=t.line;h=$("\x3cdiv id\x3dlegendDiv\x3e\x3c/div\x3e");e.$container.append(h);l=e.getResourcePath("images.graphic","png");g=$("\x3cdiv id\x3dgraphics class\x3drow\x3e\x3c/div\x3e");g.append("\x3cspan class\x3dtext\x3eGraphics: O\x3c/span\x3e");
g.append("\x3cimg id\x3dcolorschema src\x3d"+l+"\x3e");g.append("\x3cspan class\x3dtext\x3eD\x3c/span\x3e");h.append(g);l=$("\x3cdiv id\x3dfailedRoute class\x3drow\x3e\x3c/div\x3e");g=$("\x3cspan class\x3dtext\x3e\x3c/span\x3e");l.append(g);g.text("Route: "+O);h.append(l);l=e.getResourcePath("images.strandedpassenger","png");g=$("\x3cdiv id\x3dstrandedPassengers class\x3drow\x3e\x3c/div\x3e");g.append("\x3cimg id\x3dpassenger src\x3d"+l+"\x3e");g.append("\x3cspan class\x3dtext\x3e: Stranded Passengers\x3c/span\x3e");
h.append(g);l=e.getResourcePath("images.transferline","png");g=$("\x3cdiv id\x3dtransferRoute class\x3drow\x3e\x3c/div\x3e");g.append("\x3cimg id\x3dpassenger src\x3d"+l+"\x3e");g.append("\x3cspan class\x3dtext\x3e: Transfer Route\x3c/span\x3e");h.append(g);k();F=t.stationName;p=d3.select("#"+e.$container.attr("id")).append("svg").attr("width",c).attr("height",v).attr("top",0).attr("left",0);I=v/2;l=c-200;g=$("\x3cdiv class\x3dline\x3e"+t.line+"\x3c/div\x3e");g.css({top:I-25,left:l+5,background:"#00cccc"});
e.$container.append(g);g=l+5+70+5;d=$("\x3cdiv class\x3dline\x3e\x3c/div\x3e");d.css({height:10,width:c-g,top:I-5,left:g,background:"#00cccc"});e.$container.append(d);M=d3.scale.ordinal().domain(F).rangeBands([0,l]);Q=M(F[1])-M(F[0]);l=d3.svg.axis().scale(M).orient("bottom").tickSize(8,0);p.append("g").attr("class","axis").attr("transform","translate(0,"+I+")").call(l).selectAll("text").attr("y",35);l=t.stationName.indexOf(t.car);for(g=l+1;g<l+4;g++)q=M(t.stationName[g])+Q/2,a=$("\x3cdiv class\x3dpassenger\x3e"),
a.attr("id","p"+g),d=q-50,a.css({position:"absolute",top:I+50,left:d,width:100,height:100,background:"url("+mx.getResourcePath("bds.res.images.passenger_none","png")+")",cursor:"pointer"}),console.log("click here"),a.on("click",f),e.$container.append(a),g==l+1&&(a=$("\x3cdiv\x3e"),a.css({position:"absolute",top:I-114-20,left:q-42,width:89,height:114,background:"url("+mx.getResourcePath("bds.res.images.delay","png")+")"}),a.append("\x3cspan class\x3ddelay\x3eDelayed\x3c/span\x3e"),q=$("\x3cspan class\x3ddelay\x3e\x3c/span\x3e"),
q.text(t.delay+"min"),a.append(q),e.$container.append(a)),q=$("\x3cdiv class\x3dpassengerNumber\x3e"),q.css({position:"absolute",id:"passenger"+g,top:I+50+50,left:d+48,width:46,height:46,"line-height":"46px","text-align":"center",color:"black",cursor:"pointer"}),q.text("\x3d"+t.strandedPassengers[g]),q.attr("id","p"+g),q.on("click",f),e.$container.append(q),p.append("circle").style("stroke","#ff0000").style("stroke-width",2).style("fill","white").attr("r",6).attr("cx",M(t.stationName[g])+Q/2).attr("cy",
I);l=M(F[1]);g=v/2;d=d3.svg.arc().innerRadius(0).outerRadius(62).startAngle(-Math.PI/2).endAngle(Math.PI/2);p.append("path").attr("class","path").attr("id","arcStyle").attr("d",d).attr("transform","translate("+(l-25)+","+(g-60)+")").style("fill","#304454").style("opacity","0.8");innerArc=d3.svg.arc().innerRadius(0).outerRadius(62).startAngle(-Math.PI/2).endAngle(-Math.PI/2+D*Math.PI);w=p.append("path").attr("class","path").attr("d",innerArc).attr("transform","translate("+(l-25)+","+(g-60)+")").style("fill",
"#c1272d").style("opacity","0.8");p.append("text").attr("transform","translate("+(l-70)+","+(g-70)+")").attr("width",100).attr("height",62).style("fill","white").text("Load Factor");A=p.append("text").attr("transform","translate("+(l-40)+","+(g-90)+")").attr("width",100).attr("height",62).style("fill","white").text(100*D+"%");d=$("\x3cdiv id \x3d 'carDiv' class\x3dcar\x3e\x3c/div\x3e");d.css({top:g-45,left:l-70,cursor:"pointer"});d.on("click",f);e.$container.append(d);if(0!=y.length){for(l=0;l<y.length;l++)y[l].remove();
y=[]}g=t.transferlines;d=null;q=0;console.log(g);for(l=0;l<g.length;l++)if(null!=g[l]){a=M(F[l])+Q/2;for(m=0;m<g[l].length;m++)K=null,n=[],0==m?(d=v/2+5,K=desY=v/2+250):(d=v/2-5,desY=v/2-250,K=desY-50),n.push({x:a,y:d}),n.push({x:a,y:desY}),b(g[l][m],n,K,q),q++}e.setFactor(t.factor)}};e.setFactor=function(a){D=a;innerArc=d3.svg.arc().innerRadius(0).outerRadius(62).startAngle(-Math.PI/2).endAngle(-Math.PI/2+D*Math.PI);w.attr("d",innerArc);A.text(parseInt(100*D)+"%")};var Q=null,M=null,I=null;return e.endOfClass(arguments)};
bds.ui.view.ChainView.className="bds.ui.view.ChainView";$ns("bds.ui.view");$include("bds.res.ChatView.css");
bds.ui.view.ChatView=function(){function k(){var d=b.$container.find("input"),e=d.val().trim();""!=e&&(d.val(""),d={speaker:"operator",text:e,time:bds.ui.App.getTime()},null!=b.vehicle&&b.vehicle.messages.add(d),b.appendMessage(d,!0))}var b=$extend(mx.view.View);b.elementClass="ChatView";b.frame={width:460,height:280};var n={};b.vehicle=null;var f=$("\x3cdiv id\x3dheader\x3e \x3cdiv id\x3dname\x3eCrew Name\x3c/div\x3e \x3cdiv id\x3dtime\x3e00:00\x3c/div\x3e\x3c/div\x3e"),m=$("\x3cdiv id\x3dcontent\x3e\x3c/div\x3e"),
d=$("\x3cdiv id\x3dfooter\x3e \x3cinput type\x3dtext\x3e \x3cdiv id\x3dsend\x3eSend\x3c/div\x3e\x3c/div\x3e");n.init=b.init;b.init=function(u){n.init(u);b.$container.append(f);b.$container.append(m);b.$container.append(d);b.$container.find("#send").click(k);b.$container.find("input").on("keydown",function(b){13==b.keyCode&&k()})};b.setVehicle=function(d){b.clear();b.vehicle=d;f.find("#name").text(b.vehicle.crew.name);f.find("#time").text($format(b.vehicle.messages.last().time,"HH:mm"));d.messages.forEach(function(d){b.appendMessage(d)})};
b.clear=function(){m.html("")};b.appendMessage=function(b,d){var a=b.speaker,f=b.text,c=$("\x3cdiv class\x3dmessage\x3e");c.addClass(a);a=$("\x3cdiv class\x3dbubble\x3e\x3c/div\x3e");c.append(a);a.text(f);a.append("\x3cdiv id\x3dtail\x3e");m.append(c);c.css("height",a.height()+20);m.scrollTop(1E5);d&&(a.css({scale:0.1}),a.transit({scale:1}))};return b.endOfClass(arguments)};bds.ui.view.ChatView.className="bds.ui.view.ChatView";$ns("bds.ui.view");$import("bds.ui.view.VehicleListView");
bds.ui.view.CirculationVehicleListView=function(){var k=$extend(bds.ui.view.VehicleListView);k.columns=[{id:"line",text:"Line",width:100,align:"center"},{id:"stop",text:"Last Stop",width:300,align:"center"},{id:"plateNumber",text:"Plate#",width:150,align:"center"}];var b={};b.init=k.init;k.init=function(n){b.init(n)};b.updateVehicle=k.updateVehicle;k.updateVehicle=function(n,f){var m=b.updateVehicle(n,f);m.find("#line").html("\x3cspan\x3e"+n.routeNumber+"\x3c/span\x3e");m.find("#line").find("span").css("background",
n.routeLine.color);m.find("#line").attr("title",n.routeLine.directionDesc);m.find("#line").toggleClass("up",0==n.routeLine.direction);m.find("#line").toggleClass("down",1==n.routeLine.direction);var d=!1,k="N/A";if(null!=n.lastLocID){var e=bds.ui.data.RouteManager.getStop(n.lastLocID);null!=e&&(k=null!=n.lastLocID?e.desc:"N/A")}m.find("#stop").text().trim()!=k&&(d=!0,f||m.find("#stop").text(k));var a=null;60>n.delay?(m.removeClass(),m.addClass("ontime"),a=-60<n.delay?"On Time":Math.abs(Math.round(n.delay/
60))+"min Ahead"):(m.removeClass(),300>n.delay?m.addClass("delayed1"):m.addClass("delayed3"),a=Math.round(n.delay/60)+"min Delayed");m.find("#status").text().trim()!=a&&(d=!0,f||m.find("#status").text(a));f&&d&&m.delay(1500*Math.random()).transition({perspective:"1000px",rotateX:"360deg"},800,function(){m.find("#status").text(a);m.find("#stop").text(k);m.css({perspective:0,rotateX:0})});return m};return k.endOfClass(arguments)};bds.ui.view.CirculationVehicleListView.className="bds.ui.view.CirculationVehicleListView";$ns("bds.ui.view");$include("bds.res.ClockView.css");
bds.ui.view.ClockView=function(){var k=$extend(mx.view.View);k.elementClass="ClockView";var b={},n=null,f=null;b.init=k.init;k.init=function(m){b.init(m);n=$("\x3cdiv id\x3dtime\x3e");k.$container.append(n);f=$("\x3cdiv id\x3ddate\x3e");k.$container.append(f);k.$container.append("\x3cdiv id\x3dweather\x3e12\u00b0\x3c/div\x3e");k.update()};k.update=function(){var b=bds.ui.app.getTime();n.text($format(b,"HH:mm"));f.text(b.toDateString());setTimeout(k.update,3E4)};return k.endOfClass(arguments)};
bds.ui.view.ClockView.className="bds.ui.view.ClockView";$ns("bds.ui.view");$include("bds.res.FrequencySwitchView.css");
bds.ui.view.FrequencySwitchView=function(){function k(f){f=f.currentTarget.id;b.selection!=f&&(b.$container.find("li").removeClass("selected"),b.$container.find("li#"+f).addClass("selected"),b.selection=f,b.trigger("changed"))}var b=$extend(mx.view.View);b.elementTag="ul";b.elementClass="FrequencySwitchView";var n={};b.selection="circulation";b.onchanged=null;n.init=b.init;b.init=function(f){n.init(f);b.$container.append("\x3cli id\x3dcirculation class\x3dselected\x3e\x3ca\x3eIn Circulation\x3c/a\x3e\x3c/li\x3e");b.$container.append("\x3cli id\x3dreserved\x3e\x3ca\x3eReserved\x3c/a\x3e\x3c/li\x3e");
b.$container.on("click","li",k)};return b.endOfClass(arguments)};bds.ui.view.FrequencySwitchView.className="bds.ui.view.FrequencySwitchView";$ns("bds.ui.view");$import("lib.d3js.d3");$include("bds.res.LoadHistoryChartView.css");
bds.ui.view.LoadHistoryChartView=function(){function k(){t=v>y-1?y-1:v;p.passengers=d3.range(0,t).map(function(a){return Math.floor(40*Math.random()+20)});t<y-1&&(p.passengers.length=y);p.ups=p.passengers.map(function(a){return void 0==a?void 0:Math.floor(0.2*a)});f();d()}function b(){var a=d3.range(1,y+1).map(function(a){a=A*(a-0.5);return[a,0,a,w]});a.insert(0,[0,0,0,w]);E.append("g").attr("class","grid").attr("transform","translate("+h+", "+q+")").selectAll("line").data(a).enter().append("line").attr("x1",
function(a){return a[0]}).attr("y1",function(a){return a[1]}).attr("x2",function(a){return a[2]}).attr("y2",function(a){return a[3]})}function n(){s=d3.scale.linear().range([w,0]).domain([0,100]);var a=G.append("g").attr("class","passenger");O=a.append("path").datum([]);B=a.append("g").attr("class","point");B.selectAll("text").data(d3.range(0,y)).enter().append("text").attr("x",function(a,b){return b*A}).attr("transform","translate(-8, -5)");B.selectAll("circle").data(d3.range(0,y-1)).enter().append("circle").attr("r",
3.5).attr("cx",function(a,b){return b*A}).attr("cy",function(a){return s(a)});a=d3.svg.arc().innerRadius(3.5).outerRadius(5).startAngle(0).endAngle(2*Math.PI);B.selectAll("path").data(d3.range(0,y-1)).enter().append("path").attr("class","arc").attr("d",a)}function f(){var a=d3.svg.area().x(function(a,b){return 0==b?-A/2:(b-1)*A}).y0(w).y1(function(a){return s(a)}).defined(function(a){return a}),b=p.passengers.clone();b.insert(0,Math.floor(40*Math.random()+20));O.datum(b).attr("d",a);B.selectAll("circle").data(p.passengers).attr("r",
function(a){return void 0==a?0:3.5}).attr("cy",function(a){return void 0==a?0:s(a)});a=d3.svg.arc().innerRadius(3.5).outerRadius(5).startAngle(0).endAngle(2*Math.PI);B.selectAll("path").data(p.passengers).attr("d",a).each(function(a,b){void 0==a?d3.select(this).style("opacity",0):d3.select(this).style("opacity",1).attr("transform",function(g,l){return"translate("+b*A+", "+s(a)+")"})});B.selectAll("text").data(p.passengers).text(function(a){return void 0==a?"":a+"%"}).attr("y",function(a){return s(a)})}
function m(){H=G.append("g").attr("class","up");N=H.append("svg:defs");H.append("svg:image").attr("xlink:href",p.getResourcePath("images.bus","png")).attr("width",60).attr("height",60);var a=d3.scale.linear().range([1,0.1]).domain([1,F+1]);N.selectAll("linearGradient").data(d3.range(1,F+1)).enter().append("linearGradient").each(function(b,c){var d=d3.select(this).attr("id","up_"+b).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").attr("spreadMethod","pad");d.append("svg:stop").attr("offset",
"0%").attr("stop-color","rgb(0, 204, 204)").attr("stop-opacity",a(b));d.append("svg:stop").attr("offset","100%").attr("stop-color","rgb(0, 204, 204)").attr("stop-opacity",a(b+1))});H.selectAll("g").data(d3.range(0,y-1)).enter().append("g").each(function(a,b){d3.select(this).selectAll("rect").data(d3.range(1,F+1)).enter().append("rect").attr("x",A*b-0.5*(A/1.8)).attr("y",function(a,b){return 0==b%2?w-10-2*(1+3*Math.floor(b/2)):w-10-2*(1+3*(Math.floor(b/2)-1))}).attr("width",A/1.8).attr("height",3).style("fill",
function(a,b){return"url(#up_"+(b+1)+")"});d3.select(this).append("text").attr("x",A*b)})}function d(){H.selectAll("g").data(p.ups).each(function(a,b){d3.select(this).selectAll("rect").each(function(b,g){b<=a?d3.select(this).style("opacity",1):d3.select(this).style("opacity",0)});d3.select(this).select("text").text(a).attr("transform",function(a){return"translate("+0.5*-this.getBBox().width+", 0)"}).attr("y",function(a){return 0==(a+1)%2?w-10-2*(1+3*Math.floor((a+1)/2)):w-10-2*(1+3*(Math.floor((a+
1)/2)-1))})});H.select("image").attr("transform","translate("+(A*t-60)+", "+(w-30)+")")}function u(){J=E.append("g").attr("class","xaxis").attr("transform","translate("+(h+0.5*A)+", "+(w+q)+")");var a=d3.scale.ordinal().domain(d3.range(0,y)).range(d3.range(0,y).map(function(a){return a*A})),a=d3.svg.axis().scale(a).tickFormat("").orient("bottom");J.call(a).call(function(a){a.selectAll("text").attr("transform",function(a){return"rotate(-20)translate(-40, 5)"})});E.append("g").attr("class","xlabel").attr("transform",
"translate(0, "+(w+q)+")").append("line").attr("x1",0).attr("y1",0).attr("x2",p.frame.width).attr("y2",0)}function e(){var a=d3.range(v>y-1?v-y+1:0,v+1).map(function(a,b){return p.stops[a]});J.selectAll(".tick text").datum(a).text(function(a,b){return"undefined"==typeof a[b]?"":a[b].desc})}function a(){r=E.append("g").attr("class","yaxis").attr("transform","translate("+h+", "+q+")");var a=d3.scale.ordinal().domain(d3.range(0,3).reverse()).range(d3.range(0,3).map(function(a){return 2==a?a*(w/2)-10:
a*(w/2)})),a=d3.svg.axis().scale(a).tickFormat(function(a){return 0==a?0:(50*a).toString()+"%"}).orient("left");r.call(a)}var p=$extend(mx.view.View);p.elementClass="LoadHistoryChartView";var c={};c.init=p.init;p.init=function(l){c.init(l);D=p.frame.width-h-x;w=p.frame.height-q-z;A=D/y;E=d3.select(p.$element[0]).append("svg").attr("class","svg");E.append("rect").attr("class","bg").attr("x",h).attr("y",q).attr("width",D).attr("height",w);u();a();F=12;G=E.append("g").attr("calss","chart").attr("transform",
"translate("+(h+0.5*A)+", "+q+")");b();n();m();C=E.append("g").attr("class","title").attr("transform","translate("+h+", 30)");C.append("text").text("")};p.plateNumber=null;p.routeId=null;var v=p.stops=null;p.setVehicle=function(a){p.plateNumber=a.plateNumber;p.routeId=a.route.route;p.stops=a.routeLine.stops;v=a.lastStopSeq;null!=v&&(e(),C.select("text").text("Line "+p.routeId+" "+p.plateNumber),k())};var h=46,z=60,q=66,x=24,D=null,w=null,A=null,E=null,G=null,J=null,r=null,C=null,y=11,t=null;p.passengers=
null;var F=p.ups=null,O=null,B=null,s=null,H=null,N=null;return p.endOfClass(arguments)};bds.ui.view.LoadHistoryChartView.className="bds.ui.view.LoadHistoryChartView";$ns("bds.ui.view");$include("bds.res.MapView.css");
bds.ui.view.MapView=function(){function k(){p=$("\x3cul id\x3dlegend\x3e");for(var a=0;a<bds.ui.data.RouteManager.routes.length;a++){var b=bds.ui.data.RouteManager.routes[a],c=$("\x3cli\x3e"),e=$("\x3cspan id\x3dline\x3e");e.css("backgroundColor",b.color);var f=$("\x3cspan id\x3dtext\x3e");f.text("Line "+b.route);c.attr("title",b.desc);c.append(e);c.append(f);p.append(c)}d.$container.append(p)}function b(a){d.selectVehicle(a.target.id,!1)}function n(b){b=bds.ui.data.RouteManager.getStop(b.target.id);
d.selection=b;d.selectionType="stop";a.setContent("\x3cdiv class\x3dstop\x3e\x3cdiv id\x3ddesc\x3e"+b.desc+"\x3c/div\x3e \x3cdiv id\x3dnumber\x3eLine #"+b.routeLine.number+"\x3c/div\x3e \x3cdiv id\x3ddir\x3e"+b.routeLine.directionDesc+"\x3c/div\x3e");d.trigger("selectionchanged")}function f(a){if(a.popup==e){a=$(e._wrapper.parentNode);a.addClass("vehiclePopup");var b=d.selection;a.find("#routeNumber").css("backgroundColor",b.routeLine.color);a.find("#routeNumber").text(b.routeLine.number);a.find("#plateNumber").text(b.plateNumber);
a.find("#crew").text(b.crew.name);a.find("#tel").text(b.crew.phone);a.find("#load").text(b.load+"% Load Factor");if(60<b.delay){var c=Math.round(b.delay/60)+"min Delayed";a.find("#warning").html("\x3cdiv\x3e"+c+"\x3c/div\x3e").show()}else a.find("#warning").hide();c="N/A";if(null!=b.lastLocID){var f=bds.ui.data.RouteManager.getStop(b.lastLocID);null!=f&&(c=null!=b.lastLocID?f.desc:"N/A")}a.find("#stop").text(c);e.setContent(a.find(".leaflet-popup-content").html());e.update()}}function m(a){d.selection=
null;d.selectionType="none";d.trigger("selectionchanged")}var d=$extend(mx.view.View);d.elementClass="MapView";var u={};d.map=null;d.mapBoxMapId="examples.map-vyofok3q";d.defaultCenterLocation=[45.521743896993634,-122.66990661621094];d.defaultZoom=14;d.selection=null;d.selectionType=null;var e=d.onselectionchanged=null,a=null,p=null,c=null;u.init=d.init;d.init=function(b){u.init(b);d.initMap();e=L.popup({autoPan:!0,autoPanPadding:new L.point(100,100)});e.setContent('\x3cdiv id\x3d"header"\x3e\x3cdiv id\x3d"routeNumber" style\x3d"background-color: rgb(140, 198, 63);"\x3e\x3c/div\x3e\x3cdiv id\x3d"plateNumber"\x3e\x3c/div\x3e\x3c/div\x3e \x3cul\x3e\x3cli id\x3d"stop"\x3e\x3c/li\x3e\x3cli id\x3d"crew"\x3e\x3c/li\x3e\x3cli id\x3d"tel"\x3e\x3c/li\x3e\x3cli id\x3d"load"\x3e\x3c/li\x3e\x3cli id\x3d"warning" onclick\x3d"bds.ui.app.showChain();"\x3e\x3c/li\x3e\x3c/ul\x3e');
a=L.popup();d.map.on("popupopen",f);d.map.on("popupclose",m);c=$("\x3cdiv id\x3dfullScreen /\x3e");c.on("click",function(){d.toggleFullScreen()});d.$container.append(c)};d.initMap=function(){d.map=new L.map(d.$container[0],{zoomControl:!1,attributionControl:!1});L.tileLayer("https://api.tiles.mapbox.com/v3/"+d.mapBoxMapId+"/{z}/{x}/{y}.png32",{maxzoom:19,minzoom:0}).addTo(d.map)};d.loadMap=function(){d.map.setView(d.defaultCenterLocation,d.defaultZoom)};d.drawRoutes=function(){bds.ui.data.RouteManager.routeLines.forEach(function(b){(new L.multiPolyline(b.path,
{color:b.color,weight:4})).addTo(d.map);b.stops.forEach(function(c){var e=L.circleMarker({lon:c.lng,lat:c.lat},{radius:4,color:b.color,weight:2,fill:!0,opacity:1,stroke:!0,fillOpacity:0==b.direction?1:0.7,fillColor:0==b.direction?"white":b.color});e.id=c.id;e.addTo(d.map);e.bindPopup(a);e.on("click",n)})});k()};var v=[];d.drawVehicles=function(){bds.ui.data.VehicleManager.vehicles.forEach(function(a){d.drawVehicle(a)})};d.drawVehicle=function(a){var c=v["v"+a.vehicleID],f={lon:a.longitude,lat:a.latitude};
null==c?(c=L.marker(f,{icon:a.route.icon}).addTo(d.map),c.id=a.vehicleID,c.on("click",b),c.bindPopup(e),v.add(c),v["v"+a.vehicleID]=c):null==d.selection&&c.setLatLng(f);c=v["v"+a.vehicleID];null!=c&&(60<a.delay?c.setIcon(a.route.warningIcon):c.setIcon(a.route.icon))};d.selectVehicle=function(a,b){var c=bds.ui.data.VehicleManager.getVehicle(a);if(!1!=b){v.forEach(function(a){a.closePopup()});var e=v["v"+a];d.selection=c;d.selectionType="vehicle";e.openPopup()}d.selection=c;d.selectionType="vehicle";
d.trigger("selectionchanged")};var h,z;d.toggleFullScreen=function(){d.$container.hasClass("fullScreen")?(d.$container.removeClass("fullScreen"),d.$container.transit({width:h,height:z},function(){d.map.invalidateSize()}),$("#frequencyPanel").fadeIn(),$("#bottom").fadeIn()):(d.$container.addClass("fullScreen"),h=d.$container.width(),z=d.$container.height(),d.$container.transit({width:window.innerWidth,height:window.innerHeight-d.$container.find("#top").height()},function(){d.map.invalidateSize()}),
$("#frequencyPanel").fadeOut(),$("#bottom").fadeOut())};return d.endOfClass(arguments)};bds.ui.view.MapView.className="bds.ui.view.MapView";$ns("bds.ui.view");$import("lib.d3js.d3");$include("bds.res.PassengersChartView.css");
bds.ui.view.PassengersChartView=function(){function k(){C=d3.scale.linear().range([_chartHeight,0]).domain([0,100]);y=d3.svg.area().x(function(a,b){return b*r}).y0(_chartHeight).y1(function(a){return C(a)}).interpolate("basis");t=d3.svg.line().x(function(a,b){return b*r}).y(function(a,b){return C(a)}).interpolate("basis");F=d3.svg.area().x(function(a,b){return null==h?b==c.areal.length-1?(b-1)*r+s.getMinutes()/60*r:b*r:b==c.real.length-1?(b-1)*r+s.getMinutes()/60*r:b*r}).y0(_chartHeight).y1(function(a){return C(a)});
O=d3.svg.line().x(function(a,b){return null==h?b==c.areal.length-1?(b-1)*r+s.getMinutes()/60*r:b*r:b==c.real.length-1?(b-1)*r+s.getMinutes()/60*r:b*r}).y(function(a,b){return C(a)});B=d3.svg.line().x(function(a,b){return null==h?b==c.areal.length-1?(b-1)*r+s.getMinutes()/60*r:(b-1)*r:b==c.real.length-1?(b-1)*r+s.getMinutes()/60*r:(b-1)*r}).y(function(a,b){return C(a)}).defined(function(a){return null!=a})}function b(){var a=[0,0,0,6,15,35,42,81,60,38,33,37,32,20,24,32,42,79,55,35,17,7,2,0];null==
h?(0==c.ahist.length&&(c.ahist=a.map(function(a){return 0==a?0:Math.abs(Math.floor(20*Math.random())-10+a)}),c.ahist.push(c.ahist[0])),_$chart.select(".historical_area").datum(c.ahist).attr("d",y),_$chart.select(".historical_line").datum(c.ahist).attr("d",t)):(c.hist=a,c.hist=c.hist.map(function(a){return 0==a?0:Math.abs(Math.floor(20*Math.random())-10+a)}),c.hist.push(c.hist[0]),_$chart.select(".historical_area").datum(c.hist).attr("d",y),_$chart.select(".historical_line").datum(c.hist).attr("d",
t));e()}function n(){s=bds.ui.app.getTime();var a=s.getHours();if(null==h){0==c.areal.length&&(c.areal=c.ahist.map(function(a){return 0==a?0:Math.floor(100*(a-Math.floor(10*Math.random())+10)/110)}));var b=c.areal[a]+(c.areal[a+1]-c.areal[a])*s.getMinutes()/60;c.areal.length=a+1;c.fore=c.ahist.map(function(a){return 0==a?0:Math.floor(100*(a-Math.floor(5*Math.random())+5)/110)});c.areal.push(b);for(a=0;a<c.areal.length-1;a++)c.fore[a]=null;c.fore.insert(c.areal.length-1,b);_$chart.select(".realtime_area").datum(c.areal).attr("d",
F);_$chart.select(".realtime_line").datum(c.areal).attr("d",O)}else{c.real=c.hist.map(function(a){return 0==a?0:Math.floor(100*(a-Math.floor(10*Math.random())+10)/110)});b=c.real[a]+(c.real[a+1]-c.real[a])*s.getMinutes()/60;c.real.length=a+1;c.fore=c.hist.map(function(a){return 0==a?0:Math.floor(100*(a-Math.floor(5*Math.random())+5)/110)});c.real.push(b);for(a=0;a<c.real.length-1;a++)c.fore[a]=null;c.fore.insert(c.real.length-1,b);_$chart.select(".realtime_area").datum(c.real).attr("d",F);_$chart.select(".realtime_line").datum(c.real).attr("d",
O)}_$chart.select(".forecast").datum(c.fore).attr("d",B)}function f(){var a;a=null==h?(c.areal.length-2)*r+s.getMinutes()/60*r:(c.real.length-2)*r+s.getMinutes()/60*r;var b;b=null==h?C(c.areal[c.areal.length-1]):C(c.real[c.real.length-1]);_$chart.select(".bubble").style("opacity",1).attr("transform",function(c){return"translate("+(a-25)+","+(b-40)+")"});_$chart.select(".bubble text").text(function(){return Date.format(s,"HH:mm")});_$chart.select(".indicator line").attr("x1",a).attr("y1",_chartHeight).attr("x2",
a).attr("y2",b)}function m(){b();n();f()}function d(){var a=d3.scale.ordinal().domain(d3.range(0,J)).range(d3.range(0,J).map(function(a){return a*r})),a=d3.svg.axis().scale(a).tickFormat(function(a){return d3.format("02d")(a)+":00"}).orient("bottom");q.append("g").attr("class","xaxis").attr("transform","translate("+D+", "+(_chartHeight+w)+")").call(a)}function u(){var a=d3.scale.ordinal().domain(d3.range(0,3).reverse()).range(d3.range(0,3).map(function(a){return a*((_chartHeight-24)/2)})),a=d3.svg.axis().scale(a).tickFormat(function(a,
b){return""}).orient("left");q.append("g").attr("class","yaxis").attr("transform","translate("+D+", "+(w+24)+")").call(a)}function e(){var a=d3.scale.ordinal().domain(d3.range(0,3).reverse()).range(d3.range(0,3).map(function(a){return a*((_chartHeight-24)/2)})),b=Math.floor(4*Math.random()),a=d3.svg.axis().scale(a).tickFormat(function(a,c){return null==h?0==a?"0":300*a:a*[30,35,40,45][b]}).orient("left");q.selectAll(".yaxis").attr("transform","translate("+D+", "+(w+24)+")").call(a)}function a(){var a=
d3.range(0,3).map(function(a){return a*((_chartHeight-24)/2)}).map(function(a){return[0,a,G,a]});a.push([0,-24,0,_chartHeight-24]);_$chart.insert("g").attr("class","grid").attr("transform","translate(0, 24)").selectAll("line").data(a).enter().append("line").attr("x1",function(a){return a[0]}).attr("y1",function(a){return a[1]}).attr("x2",function(a){return a[2]}).attr("y2",function(a){return a[3]})}function p(a){null==a||"undefined"==typeof a?x.text(""):x.text("- "+a)}var c=$extend(mx.view.View);
c.elementClass="PassengersChartView";var v={};v.init=c.init;c.init=function(b){v.init(b);G=c.frame.width-D-E;_chartHeight=c.frame.height-w-A;r=G/J;q=d3.select(c.$element[0]).append("svg").attr("class","svg");k();_$chart=q.append("g").attr("calss","chart").attr("transform","translate("+D+", "+w+")");_$chart.append("path").datum([]).attr("class","historical_area");_$chart.append("path").datum([]).attr("class","historical_line");_$chart.append("path").datum([]).attr("class","realtime_line");_$chart.append("path").datum([]).attr("class",
"realtime_area");_$chart.append("path").datum([]).attr("class","forecast");a();b=q.append("g").attr("class","legend").attr("transform","translate("+(G+D-307)+", "+0.3*w+")");var e=b.append("g");e.append("rect").attr("width",10).attr("height",20).attr("fill","#82fef1").attr("fill-opacity",0.2).attr("stroke","#82fef1");e.append("text").text("Historical").attr("transform","translate(20, 15)");e=b.append("g").attr("transform","translate(100, 0)");e.append("rect").attr("width",10).attr("height",20).attr("fill",
"#f6c233").attr("fill-opacity",0.2).attr("stroke","#f6c233");e.append("text").text("Real-time").attr("transform","translate(20, 15)");b=b.append("g").attr("transform","translate(200, 0)");b.append("line").attr("x1",0).attr("y1",0).attr("x2",15).attr("y2",0).attr("stroke","#f6c233").attr("stroke-width",2).attr("stroke-dasharray","5 5").attr("transform","translate(0, 10)");b.append("text").text("Forecast").attr("transform","translate(20, 15)");b=q.append("g").attr("transform","translate("+D+", "+0.5*
w+")");b.append("text").attr("class","title").text("BRIM Passengers");x=b.append("text").attr("class","subtitle").attr("transform","translate(150, 0)").text("");d();u();H=_$chart.append("g").attr("class","bubble");H.append("path").attr("d","M0,0 L0,30 L20,30 L25,35 L30,30 L50,30 L50,0 L0,0 Z M0,0");_$chart.select(".bubble").style("opacity","0");H.append("text").text("").attr("x",4).attr("y",20);N=_$chart.append("g").attr("class","indicator");N.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",
0).attr("stroke","#f6c233").attr("stroke-width",1).attr("stroke-dasharray","5 5")};var h=null,z=null;c.loadPassengers=function(a){h="undefined"==typeof a||null==a?null:a;p(h);null!=z&&(window.clearInterval(z),z=null);null==z&&(m(),z=window.setInterval(function(){m()},3E4))};c.loadHistory=function(){b()};c.update=function(){m()};var q=null,x=null,D=46,w=66,A=46,E=24,G=null,J=24,r=null,C=null,y=null,t=null,F=null,O=null,B=null,s=null;c.hist=[];c.real=[];c.fore=[];c.ahist=[];c.areal=[];var H=z=null,
N=null;return c.endOfClass(arguments)};bds.ui.view.PassengersChartView.className="bds.ui.view.PassengersChartView";$ns("bds.ui.view");$include("bds.res.PrecisionMarketingView.css");
bds.ui.view.PrecisionMarketingView=function(){function k(){var f=$("\x3cdiv id \x3d PrecisionMarketing\x3e\x3c/div\x3e"),m=$("\x3cdiv id \x3d left class\x3dunhoved\x3e\x3c/div\x3e"),d=$("\x3cdiv id \x3d right class\x3dunhoved\x3e\x3c/div\x3e"),k=$("\x3cul id \x3d PM_ul\x3e\x3c/ul\x3e"),e=$("\x3cli id\x3d hardrock class\x3dicon \x3e\x3c/li\x3e"),a=$("\x3cli id\x3d starbuks class\x3dicon \x3e\x3c/li\x3e"),p=$("\x3cli id\x3d costa class\x3dicon\x3e\x3c/li\x3e"),c=$("\x3cli id\x3d mcd class\x3dicon \x3e\x3c/li\x3e"),
n=$("\x3cul id \x3d push\x3e\x3c/ul\x3e"),h=$("\x3cli id\x3d push1 class\x3dpushIcon\x3e\x3ctext\x3ePush\x3c/text\x3e\x3c/li\x3e"),z=$("\x3cli id\x3d push2 class\x3dpushIcon\x3e\x3ctext\x3ePush\x3c/text\x3e\x3c/li\x3e"),q=$("\x3cli id\x3d push3 class\x3dpushIcon\x3e\x3ctext\x3ePush\x3c/text\x3e\x3c/li\x3e"),x=$("\x3cli id\x3d push4 class\x3dpushIcon\x3e\x3ctext\x3ePush\x3c/text\x3e\x3c/li\x3e");n.append(h);n.append(z);n.append(q);n.append(x);k.append(a);k.append(e);k.append(p);k.append(c);f.append(m);
f.append(d);f.append(k);f.append(n);m.hover(function(){m.addClass("hoved").removeClass("unhoved")},function(){m.addClass("unhoved").removeClass("hoved")});d.hover(function(){d.addClass("hoved").removeClass("unhoved")},function(){d.addClass("unhoved").removeClass("hoved")});b.$element.append(f);e.css({background:"url("+mx.getResourcePath("bds.res.images.hardrock","png")+")","z-index":99999});a.css({background:"url("+mx.getResourcePath("bds.res.images.starbuks","png")+")","z-index":99999});p.css({background:"url("+
mx.getResourcePath("bds.res.images.costa","png")+")","z-index":99999});c.css({background:"url("+mx.getResourcePath("bds.res.images.mcd","png")+")","z-index":99999});f.css({width:500,height:133,position:"absolute",background:"white",opacity:0.7})}var b=$extend(mx.view.View);b.elementClass="PrecisionMarketingView";var n={};b.$element=$("\x3cdiv/\x3e");n.init=b.init;b.init=function(b){n.init(b);k()};return b.endOfClass(arguments)};bds.ui.view.PrecisionMarketingView.className="bds.ui.view.PrecisionMarketingView";$ns("bds.ui.view");$import("bds.ui.view.VehicleListView");
bds.ui.view.ReservedVehicleListView=function(){var k=$extend(bds.ui.view.VehicleListView);k.columns=[{id:"plateNumber",text:"Plate",width:100,align:"center"},{id:"place",text:"Place",width:150,align:"center"},{id:"crew",text:"Crew",width:200,align:"center"}];var b={};b.init=k.init;k.init=function(n){b.init(n);k.setVehicles(bds.ui.data.VehicleManager.getReservedVehicles())};b.updateVehicle=k.updateVehicle;k.updateVehicle=function(k,f){var m=b.updateVehicle(k,f);m.find("#crew").text(k.crew.name);m.find("#status").text(k.status);
m.find("#place").text(k.place);"In Maintenance"==k.status&&m.addClass("maintenance")};return k.endOfClass(arguments)};bds.ui.view.ReservedVehicleListView.className="bds.ui.view.ReservedVehicleListView";$ns("bds.ui.view");$include("bds.res.VehicleListView.css");
bds.ui.view.VehicleListView=function(){function k(a){a=bds.ui.data.VehicleManager.getVehicle(a.currentTarget.id.substr(1));b.trigger("vehicleclick",{vehicle:a})}var b=$extend(mx.view.View);b.elementClass="VehicleListView";var n={};b.columns=[];b.vehicles=[];b.onvehicleclick=null;var f=$("\x3cdiv id\x3dheader\x3e"),m=$("\x3ctable cellpadding\x3d0 cellspacing\x3d0\x3e \x3ccolgroup\x3e\x3c/colgroup\x3e \x3ctbody\x3e \x3ctr\x3e\x3c/tr\x3e \x3c/tbody\x3e \x3c/table\x3e"),d=$("\x3cdiv id\x3dbody/\x3e"),
u=$("\x3ctable cellpadding\x3d0 cellspacing\x3d0\x3e\x3ctbody/\x3e\x3c/table\x3e"),e=$("\x3ctr\x3e");n.init=b.init;b.init=function(a){n.init(a);b.$container.append(f);f.append(m);b.$container.append(d);d.append(u);b.initColumns();b.setVehicles(b.vehicles);u.on("click","tr",k)};b.initColumns=function(){b.columns.add({id:"status",text:"Status",align:"center"});for(var a=m.find("colgroup"),d=m.find("tr"),c=0;c<b.columns.length;c++){var f=b.columns[c],h=$("\x3ccol\x3e");h.attr("id",f.id);null!=f.width&&
h.attr("width",f.width);a.append(h);h=$("\x3ctd\x3e");h.attr("id",f.id);f.align&&h.attr("align",f.align);d.append(h);h.text(f.text)}e=d.clone(!0);u.append(a.clone(!0))};b.clear=function(){u.find("tr").remove()};b.setVehicles=function(a){b.vehicles=a;for(a=0;a<b.vehicles.length;a++){var d=b.vehicles[a];0==u.find("#v"+d.vehicleID).length?b.appendVehicle(d,!1):b.updateVehicle(d,!0)}};b.updateVehicle=function(a,b){var c=u.find("#v"+a.vehicleID);c.find("#plateNumber").text(a.plateNumber);return c};b.appendVehicles=
function(a){a.forEach(function(a){b.appendVehicle(a)})};b.appendVehicle=function(a){var d=e.clone(!0);d.attr("id","v"+a.vehicleID);0==u.find("tr").length?u.find("tbody").append(d):u.find("tr:first-child").before(d);b.updateVehicle(a,!1);return d};b.query=function(a){null==a||""==a.trim()?u.find("tr").show():u.find("tr").each(function(b,c){for(var d="none",e=0;e<c.childNodes.length;e++)if(c.childNodes[e].innerText.toLowerCase().contains(a)){d="";break}c.style.display=d})};return b.endOfClass(arguments)};
bds.ui.view.VehicleListView.className="bds.ui.view.VehicleListView";